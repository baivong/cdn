!function(t){var a=function(t){var a=t.document,e={},n={},i="watermark",o=!1,h="bottom-right",r="watermark.png?"+ +new Date,d=127.5,s=function(){e=a.createElement("canvas"),e.style.cssText="display:none;",n=e.getContext("2d"),a.body.appendChild(e)},c=function(){o=new Image,o.src="",o.src=r,255!=d?o.complete?f():o.onload=function(){f()}:w()},f=function(){var t=o.width||o.offsetWidth,a=o.height||o.offsetHeight;m(t,a),n.drawImage(o,0,0);for(var i=n.getImageData(0,0,t,a),h=i.data,r=h.length,s=3;r>s;s+=4)h[s]=h[s]<d?h[s]:d;i.data=h,n.putImageData(i,0,0),o.onload=null,o.src="",o.src=e.toDataURL(),o.width=t,o.height=a,w()},g=function(t){t.watermark&&(o=t.watermark),t.path&&(r=t.path),t.position&&(h=t.position),t.opacity&&(d=255/(100/t.opacity)),t.className&&(i=t.className),s(),c()},m=function(t,a){e.width=t,e.height=a},l=function(t){if(e.width=t.dataset.width||t.offsetWidth,e.height=t.dataset.height||t.offsetHeight,e.width>=220&&e.height>=180){n.drawImage(t,0,0);var a=h,i=0,r=0;r=-1!=a.indexOf("top")?10:e.height-o.height-10,i=-1!=a.indexOf("left")?10:e.width-o.width-10,n.drawImage(o,i,r),t.onload=null,t.src=e.toDataURL()}$(t).removeClass("watermark")},w=function(){setTimeout(function(){for(var t=a.getElementsByClassName(i),e=t.length;e--;){var n=t[e];"IMG"==n.tagName.toUpperCase()&&(n.complete?l(n):n.onload=function(){l(this)})}},10)};return{init:function(t){g(t)}}}(t);t.wmark=a}(window);