/*  @preserve
 *  Project: Phutu uploader
 *  Description: Uploader & photo poster for Phutu's forum
 *  Author: Zzbaivong (devs.forumvi.com)
 *  Version: 1.1
 *  License: CC BY 3.0
 */
(function(b){function p(a){return a=1E9<=a?(a/1E9).toFixed(2)+" GB":1E6<=a?(a/1E6).toFixed(2)+" MB":1E3<=a?(a/1E3).toFixed(2)+" KB":1<a?a+" bytes":1==a?a+" byte":"0 byte"}function q(a){30<a.length&&(a=a.slice(0,15)+"..."+a.slice(a.length-10));return a}function c(){if(e.find("li").length){if(!e.find("li.loading").length&&b(".img_bbcode").length){var a=[];e.find("li").each(function(){var f=b(this);f.hasClass("success")?a.push(f.find(".img_bbcode").val()):a.push("L\u1ed7i \u1ea3nh "+f.find("img").data("name"))});
r.val(a.join("\n\n"));t.val(b(".img_bbcode:first").data("thumb"));g.slideDown(function(){u.animate({scrollTop:g.offset().top})})}}else m.click()}var e=b("#img_list"),k=b("#img_upload"),m=b("#img_reset"),n=b("#img_choose_wrap"),g=b("#img_data"),u=b("html,body"),r=b("#img_mess"),t=b("#img_desc"),l=location.search;""!==l&&0===l.indexOf("?postto=")&&b("#img_type").val(l.slice(8));n.on("change","#img_choose",function(){k.prop("disabled",!0);b.each(this.files,function(a,f){if(/^image\/(jpeg|png|bmp|gif)$/.test(this.type)){var d=
f.name;if(!b('img[data-name="'+d+'"]').length){var c=new FileReader,h=new Image;c.readAsDataURL(f);c.onload=function(a){h.src=a.target.result;var c=b("<img>",{src:a.target.result});c.watermark({path:"data:image/png;base64,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",
done:function(a){var b=this.width,h=this.height;c.attr({src:a,"class":"watermark","data-width":b,"data-height":h,"data-name":d});e.append(c);c.wrap('<li class="ui-state-default"></li>');c.after('<div class="img_close">close</div><div class="img_details"><p><strong>Name</strong>: '+q(d)+"</p><p><strong>Size</strong>: ("+b+"x"+h+") "+p(f.size)+'</p></div><div class="img_progress_bar"><div class="img_progress"></div></div>')}})}}}});n.html('<input id="img_choose" type="file" multiple accept="image/*" /><span>Ch\u1ecdn \u1ea3nh</span>');
e.sortable({placeholder:"ui-state-highlight",update:function(a,b){c()}}).disableSelection();k.prop("disabled",!1)});k.click(function(){e.find("li:not(.success)").each(function(a,e){var d=b(this),g=d.find("img").attr("src").replace(/data:image\/.+;base64\,/,"");d.removeClass("error").addClass("loading");b.ajax({url:"https://api.imgur.com/3/image",xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){a.lengthComputable&&d.find(".img_progress").css({width:a.loaded/
a.total*100+"%"})},!1);return a},method:"POST",headers:{Authorization:"Client-ID 376e1e3bc7aaf7c"},data:{image:g,type:"base64"},success:function(a){var b=a.data.link;d.removeClass("loading").addClass("success");d.find(".img_details").html('<p><input class="img_bbcode" data-thumb="'+b.replace(/(.+)(\.)(png|jpg|gif|bmp)$/,"$1m.$3")+'" onclick="this.select();" type="text" value="[img]'+b+'[/img]" /></p><p><a href="'+b+'" target="_blank">Xem \u1ea3nh</a><a href="http://imgur.com/delete/'+a.data.deletehash+
'" target="_blank">X\u00f3a \u1ea3nh</a></p>');c()},error:function(a){d.removeClass("loading").addClass("error");c();console.warn(a)}})})});m.click(function(){e.empty();g.slideUp()});e.on("click",".img_close",function(){b(this).parent().remove();c()})})(jQuery);