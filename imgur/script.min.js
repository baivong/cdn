/*  @preserve
 *  Project: Phutu uploader
 *  Description: Uploader & photo poster for Phutu's forum
 *  Author: Zzbaivong (devs.forumvi.com)
 *  Version: 1.1
 *  License: CC BY 3.0
 */
!function(e){"use strict";function a(e){return e>=1e9?e=(e/1e9).toFixed(2)+" GB":e>=1e6?e=(e/1e6).toFixed(2)+" MB":e>=1e3?e=(e/1e3).toFixed(2)+" KB":e>1?e+=" bytes":1==e?e+=" byte":e="0 byte",e}function t(e){return e.length>30&&(e=e.slice(0,15)+"..."+e.slice(e.length-10)),e}function i(){if(s.find("li").length){if(!s.find("li.loading").length&&e(".img_bbcode").length){var a=[];s.find("li").each(function(){var t=e(this);a.push(t.hasClass("success")?t.find(".img_bbcode").val():"Lỗi ảnh "+t.find("img").data("name"))}),o.val(a.join("\n\n")),c.val(e(".img_bbcode:first").data("thumb")),l.slideDown(function(){r.animate({scrollTop:l.offset().top})})}}else n.click()}var s=e("#img_list"),d=e("#img_upload"),n=e("#img_reset"),A=e("#img_choose_wrap"),l=e("#img_data"),r=e("html,body"),o=e("#img_mess"),c=e("#img_desc");A.on("change","#img_choose",function(){d.prop("disabled",!0),e.each(this.files,function(i,d){if(/^image\/(jpeg|png|bmp|gif)$/.test(this.type)){var n=d.name;if(!e('img[data-name="'+n+'"]').length){var A=new FileReader,l=new Image;A.readAsDataURL(d),A.onload=function(i){l.src=i.target.result;var A=e("<img>",{src:i.target.result});A.watermark({path:"data:image/png;base64,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",done:function(e){var i=this.width,l=this.height;A.attr({src:e,"class":"watermark","data-width":i,"data-height":l,"data-name":n}),s.append(A),A.wrap('<li class="ui-state-default"></li>'),A.after('<div class="img_close">close</div><div class="img_details"><p><strong>Name</strong>: '+t(n)+"</p><p><strong>Size</strong>: ("+i+"x"+l+") "+a(d.size)+'</p></div><div class="img_progress_bar"><div class="img_progress"></div></div>')}})}}}}),A.html('<input id="img_choose" type="file" multiple accept="image/*" /><span>Chọn ảnh</span>'),s.sortable({placeholder:"ui-state-highlight",update:function(){i()}}).disableSelection(),d.prop("disabled",!1)}),d.click(function(){s.find("li:not(.success)").each(function(){var a=e(this),t=a.find("img").attr("src").replace(/data:image\/.+;base64\,/,"");a.removeClass("error").addClass("loading"),e.ajax({url:"https://api.imgur.com/3/image",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){e.lengthComputable&&a.find(".img_progress").css({width:e.loaded/e.total*100+"%"})},!1),e},method:"POST",headers:{Authorization:"Client-ID 376e1e3bc7aaf7c"},data:{image:t,type:"base64"},success:function(e){var t=e.data.link;a.removeClass("loading").addClass("success"),a.find(".img_details").html('<p><input class="img_bbcode" data-thumb="'+t.replace(/(.+)(\.)(png|jpg|gif|bmp)$/,"$1s.$3")+'" onclick="this.select();" type="text" value="[img]'+t+'[/img]" /></p><p><a href="'+t+'" target="_blank">Xem ảnh</a><a href="http://imgur.com/delete/'+e.data.deletehash+'" target="_blank">Xóa ảnh</a></p>'),i()},error:function(e){a.removeClass("loading").addClass("error"),i(),console.warn(e)}})})}),n.click(function(){s.empty(),l.slideUp()}),s.on("click",".img_close",function(){e(this).parent().remove(),i()})}(jQuery);